@use "mixins";
@use "tokens/fonts";

@mixin css {
	:root {
		@include mixins.light-theme;
	}

	@media (prefers-color-scheme: dark) {
		:root {
			@include mixins.dark-theme;
		}
	}

	[data-theme="light"] {
		@include mixins.light-theme;
	}

	[data-theme="dark"] {
		@include mixins.dark-theme;
	}

	body {
		@include fonts.body-1;

		background: var(--surface-1);
		color: var(--text-1);

		// Prevent scrollbars (especially on windows) when setting inline-size to
		// 100vw to achive full-bleed or other breakout effects in the layout.
		overflow-x: hidden;

		--site-margin: var(--space-s);

		> header img {
			max-height: var(--icon-lg);
		}

		> header a[href="/"] {
			background-image: url("/img/evan-alt-64.jpg");
			background-size: cover;

			&:hover > * {
				opacity: 0;
			}
		}

		> header nav a {
			text-decoration: none;
			border-bottom: 0.125em solid transparent;

			&[aria-current] {
				border-color: var(--primary-1);
			}
		}
	}

	:focus {
		outline: var(--space-xs) solid var(--text-1);
		outline-offset: var(--space-xs);
	}

	footer svg {
		height: var(--icon-sm);
	}

	h1 {
		@include fonts.display-1;
		text-align: center;
	}

	h2 {
		@include fonts.heading-1;

		> a {
			text-decoration: none;
		}
	}

	h3 {
		@include fonts.heading-2;
	}

	hr {
		border: none;
		border-block-start: 1px solid var(--text-1);
	}

	aside {
		--space: var(--space-xl);
		border-block: 1px solid var(--color-gray-3);
		margin-block-end: var(--space);
		padding: var(--space-l);

		p + p {
			margin-block-start: 1em;
		}
	}

	aside,
	figcaption,
	small {
		@include fonts.body-3;
	}

	figure {
		--_size: min(100vw, var(--measure-lg));

		box-sizing: border-box;
		inline-size: var(--_size);
		margin-inline-start: calc((100% - var(--_size)) / 2);
	}

	blockquote,
	blockquote + *,
	figure,
	figure + *,
	hr,
	hr + * {
		--space: var(--space-l);
	}

	figcaption {
		margin-block-start: var(--space-s);
		padding-inline: var(--site-margin);
		text-align: center;
		color: var(--text-2);
	}

	blockquote {
		@include fonts.body-5;

		max-width: var(--measure-s);
		margin-inline: auto;
		padding: var(--space-m);
		font-weight: normal;
		background-color: var(--surface-2);
	}

	pre {
		padding: var(--space-m);
		overflow-x: auto;

		code {
			padding: 0;
		}
	}

	code {
		@include fonts.body-2;
		border-radius: 0.125em;
		padding: 0.125em;
	}

	li + li {
		margin-block-start: var(--space-s);
	}

	a {
		--color: var(--text-1);
		--visited-color: var(--text-1);
		--hover-color: var(--primary-1);

		text-underline-offset: 0.125em;
		color: var(--color);
		transition: color 150ms linear;

		&:hover {
			color: var(--hover-color);
		}

		&:visited:not(:hover) {
			color: var(--visited-color);
		}
	}

	button {
		--background: var(--surface-2);
		--border: var(--text-3);
		--color: var(--text-1);
		--active-background: var(--text-1);
		--active-color: var(--surface-2);
		--focus-background: var(--surface-2);
		--focus-color: var(--text-1);
		--focus-outline: var(--text-1);

		border: 1px solid var(--border);
		border-radius: 0.25rem;
		padding: var(--space-xs) var(--space-s)
			calc(var(--space-xs) * 0.666);
		line-height: 1;
		color: var(--color);
		font-weight: var(--font-weight-bold);
		background-color: var(--background);

		&:active,
		&[aria-pressed] {
			--focus-background: var(--active-background);
			--focus-color: var(--active-color);

			background: var(--active-background);
			color: var(--active-color);
		}

		&:focus:not(:focus-visible) {
			outline: none;
		}

		&:focus-visible {
			background: var(--focus-background);
			color: var(--focus-color);
			outline: var(--space-xs) solid var(--focus-outline);
			outline-offset: 0;
		}
	}

	input {
		--background: var(--surface-1);
		--border: var(--text-2);
		--color: var(--text-1);
		--focus-background: var(--surface-1);
		--focus-color: var(--text-1);
		--focus-outline: var(--text-1);

		border: 1px solid var(--border);
		border-radius: 0.25rem;
		padding: var(--space-s) var(--space-m)
			calc(var(--space-s) * 0.666);
		line-height: 1;
		color: var(--color);
		background-color: var(--background);

		&:focus:not(:focus-visible) {
			outline: none;
		}

		&:focus-visible {
			background: var(--focus-background);
			color: var(--focus-color);
			outline: 2px solid var(--focus-outline);
			outline-offset: 0;
		}
	}

	[class*="aspect-"] > iframe {
		width: 100%;
		height: 100%;
		object-fit: contain;
	}

	.footnotes {
		@include fonts.body-4;
	}

	[href="#Skip"] {
		position: absolute;
		left: 50%;
		top: 0;
		transform: translate(-50%, -100%);
		border-radius: 4px;
		padding: var(--space-xs) var(--space-s);
		background-color: var(--surface-2);
		text-decoration: none;
		opacity: 0;
		transition-property: top, transform, opacity;
		transition-duration: 300ms;
		transition-timing-function: ease;

		&:focus {
			outline: var(--space-xs) solid var(--primary-1);
			outline-offset: 0;
			transform: translate(-50%, 0);
			top: var(--space-m);
			opacity: 1;
		}
	}
}
